<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>UNO Extreme Fixed</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: radial-gradient(circle at center, #1e3c1b, #000000);
            font-family: 'Arial Black', sans-serif;
            color: white;
            height: 100vh;
            user-select: none;
        }

        .screen {
            position: fixed; inset: 0;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(10, 25, 12, 0.98); z-index: 100;
        }
        .hidden { display: none !important; }

        .btn {
            padding: 15px 40px; font-size: 24px; border: none; border-radius: 50px;
            background: #e74c3c; color: white; cursor: pointer;
            box-shadow: 0 6px 0 #c0392b; transition: 0.1s; margin-top: 20px;
        }
        .btn:active { transform: translateY(6px); box-shadow: none; }
        
        input {
            padding: 15px; border-radius: 10px; border: none; 
            text-align: center; font-size: 18px; margin: 10px; width: 220px;
        }

        #game-ui { display: flex; flex-direction: column; align-items: center; height: 100%; width: 100%; }
        
        #table-area {
            display: flex; gap: 80px; align-items: center; justify-content: center;
            flex-grow: 1; margin-bottom: 150px;
        }

        .card-visual {
            width: 120px; height: 175px;
            border-radius: 12px;
            position: relative;
            box-shadow: 0 10px 20px rgba(0,0,0,0.6);
            cursor: pointer;
            background-size: 100% 100%;
            background-position: center;
            flex-shrink: 0;
            transition: transform 0.2s;
            background-color: #333; /* Fallback if image fails */
        }

        /* We remove the .num style because your images already have numbers on them */

        #hand-wrapper {
            position: fixed; bottom: 30px; width: 100%;
            display: flex; justify-content: center;
        }
        #hand { display: flex; justify-content: center; align-items: flex-end; padding: 0 60px; }
        .hand-card { margin-left: -60px; } 
        .hand-card:first-child { margin-left: 0; }
        .hand-card:hover { transform: translateY(-50px) scale(1.1); z-index: 100; }

        #anim-layer { position: fixed; inset: 0; pointer-events: none; z-index: 9999; }
        .flying {
            position: absolute; width: 120px; height: 175px; border-radius: 12px;
            background-size: 100% 100%; transition: all 0.6s cubic-bezier(0.19, 1, 0.22, 1);
        }

        .color-grid { display: flex; gap: 20px; margin-top: 20px; }
        .color-btn { width: 80px; height: 80px; border-radius: 50%; border: 4px solid white; cursor: pointer; }
    </style>
</head>
<body>

    <div id="anim-layer"></div>

    <div id="setup-screen" class="screen">
        <h1>UNO EXTREME</h1>
        <input type="text" id="p1-name" placeholder="Player 1" value="Player 1">
        <input type="text" id="p2-name" placeholder="Player 2" value="Player 2">
        <button id="start-btn" class="btn">START GAME</button>
    </div>

    <div id="pass-screen" class="screen hidden">
        <h1 id="pass-msg">READY?</h1>
        <button id="next-turn-btn" class="btn">START TURN</button>
    </div>

    <div id="game-ui" class="hidden">
        <h2 id="turn-indicator" style="color: #f1c40f;"></h2>
        <div id="table-area">
            <div id="deck" style="cursor: pointer;">
                <div class="card-visual" style="background-image: url('back.png');"></div>
            </div>
            <div id="discard-zone"></div>
        </div>
        <div id="hand-wrapper">
            <div id="hand"></div>
        </div>
    </div>

    <div id="wild-modal" class="screen hidden">
        <h2>PICK A COLOR</h2>
        <div class="color-grid">
            <div class="color-btn" style="background:#ff5555" onclick="resolveWild('red')"></div>
            <div class="color-btn" style="background:#5555ff" onclick="resolveWild('blue')"></div>
            <div class="color-btn" style="background:#55aa55" onclick="resolveWild('green')"></div>
            <div class="color-btn" style="background:#ffaa00" onclick="resolveWild('yellow')"></div>
        </div>
    </div>

    <script>
        let state = {
            deck: [], players: [[], []], names: ["", ""],
            turn: 0, discard: null, isBusy: false
        };

        document.getElementById('start-btn').onclick = startGame;
        document.getElementById('next-turn-btn').onclick = () => {
            document.getElementById('pass-screen').classList.add('hidden');
            document.getElementById('game-ui').classList.remove('hidden');
            render();
        };
        document.getElementById('deck').onclick = handleDraw;

        function startGame() {
            state.names[0] = document.getElementById('p1-name').value;
            state.names[1] = document.getElementById('p2-name').value;
            
            buildDeck();
            shuffle(state.deck);
            
            for(let i=0; i<7; i++) {
                state.players[0].push(state.deck.pop());
                state.players[1].push(state.deck.pop());
            }
            
            state.discard = state.deck.pop();
            while(state.discard.c === 'black') {
                state.deck.push(state.discard); shuffle(state.deck); state.discard = state.deck.pop();
            }

            document.getElementById('setup-screen').classList.add('hidden');
            prepTurn();
        }

        function buildDeck() {
            const colors = ['red', 'blue', 'green', 'yellow'];
            state.deck = [];
            colors.forEach(c => {
                for(let i=0; i<=12; i++) {
                    let val = i;
                    if(i===10) val="Skip"; if(i===11) val="Rev"; if(i===12) val="+2";
                    // Matches: red0.png, red1.png...
                    state.deck.push({ c: c, v: val, img: c + i + ".png" });
                    if(i !== 0) state.deck.push({ c: c, v: val, img: c + i + ".png" });
                }
            });
            for(let i=0; i<4; i++) {
                state.deck.push({ c: 'black', v: 13, img: 'wild.jpg' });
                state.deck.push({ c: 'black', v: 14, img: 'draw4.jpg' });
            }
        }

        function render() {
            document.getElementById('turn-indicator').innerText = state.names[state.turn].toUpperCase();
            const zone = document.getElementById('discard-zone');
            zone.innerHTML = '';
            zone.appendChild(createCard(state.discard));

            const hand = document.getElementById('hand');
            hand.innerHTML = '';
            state.players[state.turn].forEach((card, idx) => {
                const el = createCard(card);
                el.classList.add('hand-card');
                el.onclick = () => playCard(idx, el);
                hand.appendChild(el);
            });
        }

        function createCard(card) {
            const div = document.createElement('div');
            div.className = 'card-visual';
            div.style.backgroundImage = `url('${card.img}')`;
            return div;
        }

        function playCard(i, el) {
            if(state.isBusy) return;
            const card = state.players[state.turn][i];
            if(card.c === 'black' || card.c === state.discard.c || card.v === state.discard.v) {
                state.isBusy = true;
                const target = document.getElementById('discard-zone').getBoundingClientRect();
                animate(el, target, card.img, () => {
                    state.discard = state.players[state.turn].splice(i, 1)[0];
                    if(state.discard.c === 'black') {
                        document.getElementById('wild-modal').classList.remove('hidden');
                        state.isBusy = false;
                    } else {
                        handleAction(state.discard);
                    }
                });
            }
        }

        function handleAction(card) {
            const opp = (state.turn + 1) % 2;
            if(card.v === 'Skip' || card.v === 'Rev' || card.v === '+2') {
                if(card.v === '+2') state.players[opp].push(state.deck.pop(), state.deck.pop());
                state.isBusy = false;
                render();
            } else {
                state.turn = opp;
                state.isBusy = false;
                prepTurn();
            }
        }

        function resolveWild(color) {
            state.discard.c = color;
            document.getElementById('wild-modal').classList.add('hidden');
            if(state.discard.v === 14) {
                const opp = (state.turn + 1) % 2;
                for(let i=0; i<4; i++) state.players[opp].push(state.deck.pop());
            }
            state.turn = (state.turn + 1) % 2;
            prepTurn();
        }

        function handleDraw() {
            if(state.isBusy) return;
            state.isBusy = true;
            const card = state.deck.pop();
            const start = document.getElementById('deck').getBoundingClientRect();
            const end = { left: window.innerWidth/2, top: window.innerHeight - 100 };
            animate(null, end, 'back.png', () => {
                state.players[state.turn].push(card);
                state.isBusy = false;
                render();
            }, start);
        }

        function prepTurn() {
            document.getElementById('game-ui').classList.add('hidden');
            document.getElementById('pass-screen').classList.remove('hidden');
            document.getElementById('pass-msg').innerText = `READY ${state.names[state.turn]}?`;
        }

        function animate(el, to, img, cb, startRect) {
            const rect = startRect || el.getBoundingClientRect();
            const flyer = document.createElement('div');
            flyer.className = 'flying';
            flyer.style.backgroundImage = `url('${img}')`;
            flyer.style.left = rect.left + 'px'; flyer.style.top = rect.top + 'px';
            document.getElementById('anim-layer').appendChild(flyer);
            if(el) el.style.opacity = 0;
            setTimeout(() => {
                flyer.style.left = to.left + 'px'; flyer.style.top = to.top + 'px';
                flyer.style.transform = "rotate(360deg)";
            }, 10);
            setTimeout(() => { flyer.remove(); cb(); }, 600);
        }

        function shuffle(a) {
            for (let i = a.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
        }
    </script>
</body>
</html>
