<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>UNO Extreme Fix</title>
    <style>
        body { margin: 0; background: #1a1a1a; color: white; font-family: sans-serif; overflow: hidden; }
        .screen { position: fixed; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #0e2213; z-index: 1000; }
        .hidden { display: none !important; }
        .btn { padding: 20px 50px; font-size: 24px; background: #e74c3c; color: white; border: none; border-radius: 50px; cursor: pointer; box-shadow: 0 5px 0 #c0392b; }
        .btn:active { transform: translateY(5px); box-shadow: none; }
        input { padding: 10px; margin: 10px; border-radius: 5px; border: none; width: 200px; text-align: center; }
        
        #game-ui { display: flex; flex-direction: column; align-items: center; height: 100vh; }
        #table { flex-grow: 1; display: flex; align-items: center; gap: 50px; }
        .card-visual { width: 110px; height: 160px; background: white; border-radius: 10px; border: 4px solid white; position: relative; background-size: cover; background-position: center; box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        .num { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 60px; font-weight: bold; color: white; text-shadow: 2px 2px 4px black; }
        
        #hand { position: fixed; bottom: 20px; display: flex; justify-content: center; width: 100%; }
        .hand-card { margin-left: -40px; transition: transform 0.2s; cursor: pointer; }
        .hand-card:first-child { margin-left: 0; }
        .hand-card:hover { transform: translateY(-30px); z-index: 100; }
        
        #anim-layer { position: fixed; inset: 0; pointer-events: none; z-index: 2000; }
        .flying { position: absolute; transition: all 0.5s ease-in-out; }
    </style>
</head>
<body>

    <div id="anim-layer"></div>

    <div id="setup-screen" class="screen">
        <h1 style="font-size: 50px; color: #f1c40f;">UNO EXTREME</h1>
        <input type="text" id="p1" placeholder="Player 1" value="Player 1">
        <input type="text" id="p2" placeholder="Player 2" value="Player 2">
        <button class="btn" id="real-start-btn">START GAME</button>
    </div>

    <div id="pass-screen" class="screen hidden">
        <h1 id="pass-msg">READY?</h1>
        <button class="btn" onclick="startTurn()">START TURN</button>
    </div>

    <div id="game-ui" class="hidden">
        <h2 id="turn-txt" style="margin-top: 20px;"></h2>
        <div id="table">
            <div id="deck-zone" onclick="drawCard()" style="cursor:pointer; text-align:center;">
                <div class="card-visual" style="background-image: url('images/back.png');"></div>
                <p>DECK</p>
            </div>
            <div id="discard-zone"></div>
        </div>
        <div id="hand"></div>
    </div>

    <script>
        // Use a simpler variable system
        let state = {
            deck: [],
            players: [[], []],
            turn: 0,
            discard: null,
            names: ["", ""],
            isBusy: false
        };

        // BIND START BUTTON IMMEDIATELY
        document.getElementById('real-start-btn').onclick = function() {
            console.log("START CLICKED");
            state.names[0] = document.getElementById('p1').value;
            state.names[1] = document.getElementById('p2').value;
            
            setupGame();
            document.getElementById('setup-screen').classList.add('hidden');
            prepTurn();
        };

        function setupGame() {
            const colors = ['red', 'blue', 'green', 'yellow'];
            state.deck = [];
            
            // Build simple deck
            colors.forEach(c => {
                for(let i=0; i<=12; i++) {
                    let val = i;
                    if(i === 10) val = "Skip";
                    if(i === 11) val = "Rev";
                    if(i === 12) val = "+2";
                    state.deck.push({ c: c, v: val, img: c + ".png" });
                }
            });
            // Add Wilds
            for(let i=0; i<4; i++) {
                state.deck.push({ c: 'black', v: 'W', img: 'wild.jpg' });
                state.deck.push({ c: 'black', v: '+4', img: 'draw4.jpg' });
            }
            
            shuffle(state.deck);

            // Deal
            for(let i=0; i<7; i++) {
                state.players[0].push(state.deck.pop());
                state.players[1].push(state.deck.pop());
            }
            
            state.discard = state.deck.pop();
            while(state.discard.c === 'black') { 
                state.deck.push(state.discard); 
                shuffle(state.deck); 
                state.discard = state.deck.pop(); 
            }
        }

        function prepTurn() {
            document.getElementById('game-ui').classList.add('hidden');
            document.getElementById('pass-screen').classList.remove('hidden');
            document.getElementById('pass-msg').innerText = "READY " + state.names[state.turn] + "?";
        }

        function startTurn() {
            document.getElementById('pass-screen').classList.add('hidden');
            document.getElementById('game-ui').classList.remove('hidden');
            render();
        }

        function render() {
            document.getElementById('turn-txt').innerText = state.names[state.turn].toUpperCase() + "'S TURN";
            
            // Discard
            const dz = document.getElementById('discard-zone');
            dz.innerHTML = '';
            dz.appendChild(makeCard(state.discard));

            // Hand
            const h = document.getElementById('hand');
            h.innerHTML = '';
            state.players[state.turn].forEach((card, i) => {
                const el = makeCard(card);
                el.classList.add('hand-card');
                el.onclick = () => playCard(i, el);
                h.appendChild(el);
            });
        }

        function makeCard(card) {
            const div = document.createElement('div');
            div.className = 'card-visual';
            div.style.backgroundImage = "url('images/" + card.img + "')";
            if(card.c !== 'black') {
                const n = document.createElement('div');
                n.className = 'num';
                n.innerText = card.v;
                div.appendChild(n);
            }
            return div;
        }

        function playCard(i, el) {
            if(state.isBusy) return;
            const card = state.players[state.turn][i];
            
            if(card.c === 'black' || card.c === state.discard.c || card.v === state.discard.v) {
                state.isBusy = true;
                
                // Animate
                const rect = el.getBoundingClientRect();
                const target = document.getElementById('discard-zone').getBoundingClientRect();
                
                animate(rect, target, card.img, () => {
                    state.discard = state.players[state.turn].splice(i, 1)[0];
                    if(card.v === 'Skip' || card.v === 'Rev' || card.v === '+2') {
                        // In 2 player, these all skip the opponent
                        if(card.v === '+2') state.players[(state.turn+1)%2].push(state.deck.pop(), state.deck.pop());
                        state.isBusy = false;
                        checkWin();
                        render();
                    } else {
                        checkWin();
                        state.turn = (state.turn + 1) % 2;
                        state.isBusy = false;
                        prepTurn();
                    }
                });
            }
        }

        function drawCard() {
            if(state.isBusy) return;
            state.isBusy = true;
            
            const card = state.deck.pop();
            const start = document.getElementById('deck-zone').getBoundingClientRect();
            const end = { left: window.innerWidth/2, top: window.innerHeight - 100 };
            
            animate(start, end, 'back.png', () => {
                state.players[state.turn].push(card);
                state.isBusy = false;
                render();
            });
        }

        function animate(from, to, img, cb) {
            const flyer = document.createElement('div');
            flyer.className = 'card-visual flying';
            flyer.style.backgroundImage = "url('images/" + img + "')";
            flyer.style.left = from.left + "px";
            flyer.style.top = from.top + "px";
            document.getElementById('anim-layer').appendChild(flyer);
            
            setTimeout(() => {
                flyer.style.left = to.left + "px";
                flyer.style.top = to.top + "px";
                flyer.style.transform = "rotate(360deg)";
            }, 50);
            
            setTimeout(() => {
                flyer.remove();
                cb();
            }, 550);
        }

        function checkWin() {
            if(state.players[state.turn].length === 0) {
                alert(state.names[state.turn] + " WINS!");
                location.reload();
            }
        }

        function shuffle(a) {
            for (let i = a.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
        }
    </script>
</body>
</html>
