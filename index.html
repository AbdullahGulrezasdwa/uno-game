<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>UNO EXTREME - 2 PLAYER EDITION</title>
    <style>
        :root { --active-glow: rgba(241, 196, 15, 0.4); }
        body {
            margin: 0; overflow: hidden;
            background: radial-gradient(circle at center, #1a331a, #000000);
            font-family: 'Arial Black', sans-serif; color: white; height: 100vh; user-select: none;
            transition: box-shadow 0.5s ease;
        }

        /* Ambient Glow based on active color */
        body.glow-red { box-shadow: inset 0 0 100px rgba(231, 76, 60, 0.5); }
        body.glow-blue { box-shadow: inset 0 0 100px rgba(52, 152, 219, 0.5); }
        body.glow-green { box-shadow: inset 0 0 100px rgba(46, 204, 113, 0.5); }
        body.glow-yellow { box-shadow: inset 0 0 100px rgba(241, 196, 15, 0.5); }

        .screen { position: fixed; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; background: rgba(0,0,0,0.95); z-index: 100; }
        .hidden { display: none !important; }
        
        .btn { 
            padding: 15px 50px; font-size: 24px; border: none; border-radius: 50px; 
            background: #e74c3c; color: white; cursor: pointer; 
            box-shadow: 0 6px 0 #b33939; transition: 0.1s; 
        }
        .btn:active { transform: translateY(4px); box-shadow: none; }
        
        #game-ui { display: flex; flex-direction: column; align-items: center; height: 100%; width: 100%; }
        #table { display: flex; gap: 80px; align-items: center; justify-content: center; flex-grow: 1; margin-bottom: 120px; }
        
        .card-visual { 
            width: 140px; height: 200px; border-radius: 14px; 
            background-size: 100% 100%; background-position: center; 
            background-color: #333; border: 1px solid rgba(255,255,255,0.2);
            box-shadow: 0 15px 30px rgba(0,0,0,0.5);
        }

        #hand-container { position: fixed; bottom: 30px; width: 100%; display: flex; justify-content: center; }
        #hand { display: flex; align-items: flex-end; height: 220px; }
        .hand-card { margin-left: -75px; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); cursor: pointer; }
        .hand-card:first-child { margin-left: 0; }
        .hand-card:hover { transform: translateY(-60px) rotate(2deg); z-index: 100; filter: brightness(1.2); }

        #uno-btn {
            position: fixed; right: 50px; bottom: 150px; 
            width: 100px; height: 100px; border-radius: 50%;
            background: #e67e22; color: white; font-weight: bold;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; animation: pulse 1s infinite; border: 4px solid white;
        }

        #anim-layer { position: fixed; inset: 0; pointer-events: none; z-index: 999; }
        .flying { position: absolute; width: 140px; height: 200px; border-radius: 14px; background-size: 100% 100%; transition: all 0.6s ease-in; }

        .color-grid { display: flex; gap: 20px; margin-top: 30px; }
        .color-btn { width: 85px; height: 85px; border-radius: 50%; border: 4px solid white; cursor: pointer; transition: 0.2s; }
        .color-btn:hover { transform: scale(1.2); }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <div id="anim-layer"></div>

    <div id="setup" class="screen">
        <h1 style="color: #f1c40f; font-size: 60px; text-shadow: 4px 4px #000;">UNO EXTREME</h1>
        <button onclick="initGame()" class="btn">START GAME</button>
    </div>

    <div id="pass" class="screen hidden">
        <h1 id="pass-msg" style="font-size: 40px;">READY?</h1>
        <button onclick="startTurn()" class="btn">VIEW HAND</button>
    </div>

    <div id="game-ui" class="hidden">
        <h2 id="current-player" style="margin-top: 20px; font-size: 32px; letter-spacing: 2px;"></h2>
        <div id="table">
            <div id="deck-pile" onclick="drawCard()" style="cursor:pointer">
                <div class="card-visual" style="background-image: url('images/back.png'); border: 2px solid gold;"></div>
            </div>
            <div id="discard-pile"></div>
        </div>
        <div id="hand-container"><div id="hand"></div></div>
        <div id="uno-btn" class="hidden" onclick="shoutUno()">UNO!</div>
    </div>

    <div id="wild-modal" class="screen hidden">
        <h2 style="font-size: 36px;">PICK NEW COLOR</h2>
        <div class="color-grid">
            <div class="color-btn" style="background:#e74c3c" onclick="pickWild('red')"></div>
            <div class="color-btn" style="background:#3498db" onclick="pickWild('blue')"></div>
            <div class="color-btn" style="background:#2ecc71" onclick="pickWild('green')"></div>
            <div class="color-btn" style="background:#f1c40f" onclick="pickWild('yellow')"></div>
        </div>
    </div>

    <script>
        let game = { deck: [], players: [[], []], turn: 0, discard: null, active: true, unoCalled: false };

        function initGame() {
            const colors = ['red', 'blue', 'green', 'yellow'];
            game.deck = [];
            game.players = [[], []];
            game.turn = 0;

            // Build Deck
            colors.forEach(c => {
                for(let i=0; i<=12; i++) {
                    let val = i;
                    if(i === 10) val = "Skip"; if(i === 11) val = "Rev"; if(i === 12) val = "+2";
                    const card = { color: c, val: val, img: `images/${c}${i}.png` };
                    game.deck.push({...card});
                    if(i !== 0) game.deck.push({...card});
                }
            });

            // Wilds
            for(let i=0; i<4; i++) {
                game.deck.push({ color: 'black', val: 13, img: 'images/wild.jpg' });
                game.deck.push({ color: 'black', val: 14, img: 'images/draw4.jpg' });
            }

            shuffle(game.deck);

            // Deal 7 cards
            for(let i=0; i<7; i++) {
                game.players[0].push(game.deck.pop());
                game.players[1].push(game.deck.pop());
            }

            // Set Initial Discard
            game.discard = game.deck.pop();
            while(game.discard.color === 'black') {
                game.deck.push(game.discard); shuffle(game.deck); game.discard = game.deck.pop();
            }

            document.getElementById('setup').classList.add('hidden');
            startTurn();
        }

        function render() {
            document.body.className = `glow-${game.discard.color}`;
            document.getElementById('current-player').innerText = "PLAYER " + (game.turn + 1);
            
            const dp = document.getElementById('discard-pile');
            dp.innerHTML = ''; dp.appendChild(createCardUI(game.discard));

            const hand = document.getElementById('hand');
            hand.innerHTML = '';
            game.players[game.turn].forEach((card, idx) => {
                const el = createCardUI(card);
                el.classList.add('hand-card');
                el.onclick = () => playCard(idx, el);
                hand.appendChild(el);
            });

            // Show UNO button if player is about to play their second-to-last card
            if(game.players[game.turn].length === 2) {
                document.getElementById('uno-btn').classList.remove('hidden');
            } else {
                document.getElementById('uno-btn').classList.add('hidden');
            }
        }

        function createCardUI(card) {
            const div = document.createElement('div');
            div.className = 'card-visual';
            div.style.backgroundImage = `url('${card.img}')`;
            return div;
        }

        function playCard(idx, el) {
            if(!game.active) return;
            const card = game.players[game.turn][idx];
            
            if(card.color === 'black' || card.color === game.discard.color || card.val === game.discard.val) {
                game.active = false;
                const rect = el.getBoundingClientRect();
                const target = document.getElementById('discard-pile').getBoundingClientRect();
                
                animate(rect, target, card.img, () => {
                    game.discard = game.players[game.turn].splice(idx, 1)[0];
                    
                    // UNO Penalty Logic
                    if(game.players[game.turn].length === 1 && !game.unoCalled) {
                        alert("Busted! You didn't say UNO! Draw 2.");
                        for(let i=0; i<2; i++) if(game.deck.length > 0) game.players[game.turn].push(game.deck.pop());
                    }
                    game.unoCalled = false;

                    if(game.discard.color === 'black') {
                        document.getElementById('wild-modal').classList.remove('hidden');
                    } else {
                        if (checkWin()) return;
                        handleAction(game.discard);
                    }
                });
            }
        }

        function handleAction(card) {
            const opp = (game.turn + 1) % 2;
            
            // 2-PLAYER RULES: Skip/Rev/Plus2 keep the turn on the CURRENT player
            if(card.val === 'Skip' || card.val === 'Rev' || card.val === '+2') {
                if(card.val === '+2') {
                    for(let i=0; i<2; i++) if(game.deck.length > 0) game.players[opp].push(game.deck.pop());
                }
                alert(card.val.toUpperCase() + "! Opponent skipped. Your turn again!");
                game.active = true;
                render(); 
            } else {
                // Normal card: Pass turn
                game.turn = opp;
                prepTurn();
            }
        }

        function drawCard() {
            if(!game.active) return;
            game.active = false;
            const card = game.deck.pop();
            const start = document.getElementById('deck-pile').getBoundingClientRect();
            const end = { left: window.innerWidth/2, top: window.innerHeight - 100 };

            animate(null, end, 'images/back.png', () => {
                game.players[game.turn].push(card);
                // After drawing, turn automatically passes
                game.turn = (game.turn + 1) % 2;
                prepTurn();
            }, start);
        }

        function shoutUno() {
            game.unoCalled = true;
            document.getElementById('uno-btn').classList.add('hidden');
            alert("UNO SHOUTED!");
        }

        function pickWild(c) {
            game.discard.color = c;
            document.getElementById('wild-modal').classList.add('hidden');
            
            if(game.discard.val === 14) { // Draw 4
                const opp = (game.turn + 1) % 2;
                for(let i=0; i<4; i++) if(game.deck.length > 0) game.players[opp].push(game.deck.pop());
                alert("DRAW 4! Your turn again.");
                game.active = true;
                render();
            } else {
                game.turn = (game.turn + 1) % 2;
                prepTurn();
            }
        }

        function prepTurn() {
            game.active = false;
            document.getElementById('game-ui').classList.add('hidden');
            document.getElementById('pass').classList.remove('hidden');
            document.getElementById('pass-msg').innerText = `PLAYER ${game.turn + 1}'S TURN`;
        }

        function startTurn() {
            document.getElementById('pass').classList.add('hidden');
            document.getElementById('game-ui').classList.remove('hidden');
            game.active = true;
            render();
        }

        function animate(from, to, img, cb, startOverride) {
            const rect = startOverride || from;
            const flyer = document.createElement('div');
            flyer.className = 'flying';
            flyer.style.backgroundImage = `url('${img}')`;
            flyer.style.left = rect.left + 'px'; flyer.style.top = rect.top + 'px';
            document.getElementById('anim-layer').appendChild(flyer);
            setTimeout(() => {
                flyer.style.left = to.left + 'px'; flyer.style.top = to.top + 'px';
                flyer.style.transform = "rotate(360deg) scale(1.1)";
            }, 10);
            setTimeout(() => { flyer.remove(); cb(); }, 500);
        }

        function checkWin() {
            if(game.players[game.turn].length === 0) {
                alert("PLAYER " + (game.turn + 1) + " WINS!");
                location.reload();
                return true;
            }
            return false;
        }

        function shuffle(a) {
            for (let i = a.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
        }
    </script>
</body>
</html>
